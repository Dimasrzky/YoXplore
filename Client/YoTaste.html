<html>
    <head>
        <title>Yotaste - Explore Yogyakarta</title>
        <link rel="icon" href="../Image/Logo Yoxplore.png" type="image/png">
        <link rel="stylesheet" href="../Style/YoTaste.css">
    </head>
    <body>
        <header>
            <nav class="container">
                <a href="/Client/Home.html"><img class="logo" src="../Image/Yoxplore logo text.png" alt="Yoxplore Logo"></a>
                <button class="hamburger-menu" aria-label="Menu" onclick="toggleNav()">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                <div class="nav-links">
                    <a href="../Client/Home.html"><img src="../Image/home.png" alt="Home Icon"> Home</a>
                    <a href="../Client/YoTrip.html"><img src="../Image/yotrip.png" alt="Trip Icon"> YoTrip</a>
                    <a href="../Client/YoConcert.html"><img src="../Image/yoconcert.png" alt="Concert Icon"> YoShow</a>
                    <a href="../Client/YoTaste.html" class="active"><img src="../Image/yotaste.png" alt="Taste Icon"> YoTaste</a>
                    <a href="../Client/YoStay.html"><img src="../Image/yostay.png" alt="Stay Icon"> YoStay</a>
                
                    <!-- menu account khusus mobile -->
                    <div class="menu-account">
                        <div class="nav-divider"></div>
                        <a href="/Client/Profile.html" class="menu-item">
                            <img src="../Image/navbar/settings.png" alt="Settings Icon">
                            Account
                        </a>
                        <a href="/Client/Logout.html" class="menu-item logout">
                            <img src="../Image/navbar/logout.png" alt="Logout Icon">
                            Logout
                        </a>
                    </div>
                </div>
                <div class="user-profile">
                    <span id="usernameDisplay"></span></div>
                <div class="profile-dropdown">
                    <div class="profile-icon" onclick="toggleDropdown()">
                        <img src="../Image/user.png" alt="Profile Icon">
                    </div>
                    <div id="dropdown-menu" class="dropdown-menu">
                        <a href="../Client/Profile.html" class="menu-item">
                            <img src="../Image/navbar/settings.png" alt="Settings Icon">
                            Account 
                        </a>
                        <a href="../Client/Login.html" onclick="logout()" class="menu-item logout">
                            <img src="../Image/navbar/logout.png" alt="Logout Icon">
                            Logout
                        </a>
                    </div>
                </div>  
            </nav>
        </header>

        <div class="container">
            <section class="hero">
                <div class="text">
                    <h2>Are you hungry?</h2>
                    <p>Find the best foods and deliciouce in Yogyakarta.</p>
                </div>
                <div class="search-bar">
                    <input type="text" placeholder="where you want to go?" />
                    <a href="#"><img src="../Image/search.png">Search</a>
                </div>
            </section>
        </div>

        <div class="container3">
            <section class="most-popular">
                <div class="header-section">
                    <h2>Our Recommendation</h2>
                    <div class="shorted-by">
                        <label for="sort-options">Shorted by:</label>
                        <select id="sort-options">
                            <option value="popular">Popularity</option>
                            <option value="traditiionalFood">Traditional</option>
                            <option value="modernFood">Modern</option>
                        </select>
                    </div>
                </div>
                <div class="popular-grid">
    
                        </div>
                    </div>
                </div>
            </section>
        </div> 

        <footer class="footer">
            <div class="contact-info">
                <h3>Contact us</h3>
                <ul>
                    <li><img src="../Image/footer/clock.png" alt="Clock" class="icon"> Monday - Friday, 09:00 - 17:00</li>
                    <li><img src="../Image/footer/email.png" alt="Email" class="icon"> Email: <a href="mailto:yoxplore@gmail.com">yoxplore@gmail.com</a></li>
                    <li><img src="../Image/footer/phone-call.png" alt="Phone" class="icon"> Phone: 08123456789</li>
                    <li><img src="../Image/yotrip.png" alt="Location" class="icon"> Universitas Islam Indonesia,</li>
                    <div class="alamat">
                        Gedung K.H. Mas Mansyur, <br>
                        Daerah Istimewa Yogyakarta 55584
                    </div>
                </ul>
            </div>
            
            <div class="products">
                <h3>Products</h3>
                <ul>
                    <li><a href="/Client/Yotrip.html">YoTrip</a></li>
                    <li><a href="/Client/Yotaste.html">YoTaste</a></li>
                    <li><a href="/Client/Yoconcert.html">YoConcert</a></li>
                    <li><a href="/Client/Yostay.html">YoStay</a></li>
                </ul>
            </div>
            <div class="social-media">
                <h3>Follow us on</h3>
                <ul>
                    <li class="icon"><img src="../Image/footer/sosmed/instagram.png" alt="Instagram">Instagram</li>
                    <li class="icon"><img src="../Image/footer/sosmed/tik-tok.png" alt="TikTok">TikTok</li>
                    <li class="icon"><img src="../Image/footer/sosmed/twitter.png" alt="Twitter">X</li>
                    <li class="icon"><img src="../Image/footer/sosmed/youtube.png" alt="YouTube">YouTube</li>
                    <li class="icon"><img src="../Image/footer/sosmed/facebook.png" alt="Facebook">Facebook</li>
                    <li class="icon"><img src="../Image/footer/sosmed/telegram.png" alt="Telegram">Telegram</li>
                </ul>
            </div>
            <div class="copyright">
                Copyright &copy; 2024 Yoxplore. All rights reserved
            </div>
        </footer>   
    </body>
    <script>

        function logout() {
            // Clear semua data
            sessionStorage.clear();
            localStorage.clear();
            window.location.href = '../Client/Login.html';
        }

        document.addEventListener('DOMContentLoaded', function() {
            const usernameDisplay = document.getElementById('usernameDisplay');
            fetch('/YoXplore/Controller/get_user_data.php')
                .then(response => response.json())
                .then(data => {
                    if(data.username) {
                        usernameDisplay.textContent = data.username;

                        if (data.profileImage) {
                            const navbarProfileIcon = document.querySelector('.profile-icon img');
                            if (navbarProfileIcon) {
                                navbarProfileIcon.src = data.profileImage;
                                navbarProfileIcon.style.borderRadius = '50%';
                                navbarProfileIcon.style.width = '40px';
                                navbarProfileIcon.style.height = '40px';
                                navbarProfileIcon.style.objectFit = 'cover';
                            }
                        }
                    }
                });
        });
        
            // Load profile image berdasarkan user_id
            const userId = sessionStorage.getItem('user_id');
            const profileImage = localStorage.getItem(`profileImage_${userId}`);
            
            if (profileImage) {
                const navbarProfileIcon = document.querySelector('.profile-icon img');
                if (navbarProfileIcon) {
                    navbarProfileIcon.src = profileImage;
                    navbarProfileIcon.style.borderRadius = '50%';
                    navbarProfileIcon.style.width = '40px';
                    navbarProfileIcon.style.height = '40px';
                    navbarProfileIcon.style.objectFit = 'cover';
                }
            }

            document.addEventListener('DOMContentLoaded', function() {
                const hamburger = document.querySelector('.hamburger-menu');
                const navLinks = document.querySelector('.nav-links');
                
                hamburger.addEventListener('click', function() {
                    // Toggle active class for both hamburger and nav-links
                    this.classList.toggle('active');
                    navLinks.classList.toggle('active');
                });
            
                // Close menu when clicking outside
                document.addEventListener('click', function(event) {
                    const isClickInsideNav = navLinks.contains(event.target);
                    const isClickInsideHamburger = hamburger.contains(event.target);
                    
                    if (!isClickInsideNav && !isClickInsideHamburger && navLinks.classList.contains('active')) {
                        hamburger.classList.remove('active');
                        navLinks.classList.remove('active');
                    }
                });
            
                // Close menu when window is resized beyond tablet breakpoint
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 1024) {
                        hamburger.classList.remove('active');
                        navLinks.classList.remove('active');
                    }
                });
            });
        
        // Fungsi toggle dropdown tetap sama
        function toggleDropdown() {
            const dropdown = document.getElementById('dropdown-menu');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        }
        
        // Menutup dropdown jika klik di luar area
        window.onclick = function (event) {
            if (!event.target.closest('.profile-dropdown')) {
                const dropdown = document.getElementById('dropdown-menu');
                if (dropdown) {
                    dropdown.style.display = 'none';
                }
            }
        };

       // Fungsi untuk memuat destinasi dengan filter
       function loadTaste(category = '') {
        const url = `../Controller/get_destinations.php?section=YoTaste${category ? '&category=' + encodeURIComponent(category) : ''}`;
        
        fetch(url)
            .then(response => response.json())
            .then(result => {
                if (result.success && Array.isArray(result.data)) {
                    const container = document.querySelector('.popular-grid');
                    container.innerHTML = ''; // Bersihkan konten yang ada
                    
                    result.data.forEach(item => {
                        const itemHtml = `
                            <div class="popular-item">
                                <div class="image-container">
                                    <a href="Item3.html?id=${item.id}">
                                        <img src="data:image/jpeg;base64,${item.main_image || ''}" 
                                            alt="${item.name}"
                                            onerror="this.src='../Image/placeholder.jpg'">
                                        <div class="rating">
                                            <span>★ ${item.rating || '0'}</span>
                                        </div>
                                    </a>
                                </div>
                                <div class="content">
                                    <h3>${item.name}</h3>
                                    <div class="location">
                                        <img src="../Image/location_brown.png" alt="Ikon Lokasi">
                                        <span>${item.address}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.innerHTML += itemHtml;
                    });
                }
            })
            .catch(error => console.error('Error saat memuat destinasi:', error));
    }

    // Fungsi untuk mengisi opsi kategori
    function updateCategoryOptions() {
        const sortOptions = document.getElementById('sort-options');
        if (sortOptions) {
            const categories = [
                { value: '', text: 'All' },
                { value: 'Cafe', text: 'Cafe' },
                { value: 'Restaurant', text: 'Restaurant' },
                { value: 'Traditional', text: 'Traditional' },
                { value: 'Restaurant', text: 'Restaurant' }
            ];
            
            sortOptions.innerHTML = categories.map(category => 
                `<option value="${category.value}">${category.text}</option>`
            ).join('');
        }
    }

    // Event listener saat halaman dimuat
    document.addEventListener('DOMContentLoaded', function() {
        // Update opsi kategori
        updateCategoryOptions();
        
        // Tambahkan event listener untuk filter
        const sortOptions = document.getElementById('sort-options');
        if (sortOptions) {
            sortOptions.addEventListener('change', function() {
                loadTaste(this.value);
            });
        }
        
        // Muat data awal
        loadTaste();
    });

    // Load YoTrip destinations
function loadYoTaste(filter = '') {
fetch('../Controller/get_destinations.php?section=YoTaste&filter=' + encodeURIComponent(filter))
    .then(response => response.json())
    .then(result => {
        // Proses data hasil fetch dan tampilkan ke halaman
    })
    .catch(error => {
        console.error('Error loading YoTaste destinations:', error);
    });
}

// Tambahkan fungsi search
function searchDestinations(searchTerm) {
    const url = `../Controller/get_destinations.php?section=YoTaste&search=${encodeURIComponent(searchTerm)}`;
    
    fetch(url)
        .then(response => response.json())
        .then(result => {
            if (result.success && Array.isArray(result.data)) {
                const container = document.querySelector('.popular-grid');
                container.innerHTML = ''; // Bersihkan konten yang ada
                
                if (result.data.length === 0) {
                    container.innerHTML = '<div class="no-results">Tidak ada hasil yang ditemukan</div>';
                    return;
                }
                
                result.data.forEach(item => {
                    const itemHtml = `
                        <div class="popular-item">
                            <div class="image-container">
                                <a href="Item3.html?id=${item.id}">
                                    <img src="data:image/jpeg;base64,${item.main_image || ''}" 
                                         alt="${item.name}"
                                         onerror="this.src='../Image/placeholder.jpg'">
                                    <div class="rating">
                                        <span>★ ${item.rating || '0'}</span>
                                    </div>
                                </a>
                            </div>
                            <div class="content">
                                <h3>${item.name}</h3>
                                <div class="location">
                                    <img src="../Image/location_brown.png" alt="Ikon Lokasi">
                                    <span>${item.address}</span>
                                </div>
                            </div>
                        </div>
                    `;
                    container.innerHTML += itemHtml;
                });
            }
        })
        .catch(error => console.error('Error saat mencari destinasi:', error));
}

// Tambahkan event listener untuk search bar
document.addEventListener('DOMContentLoaded', function() {
    const searchInput = document.querySelector('.search-bar input');
    const searchButton = document.querySelector('.search-bar a');

    // Event untuk tombol search
    searchButton.addEventListener('click', function(e) {
        e.preventDefault();
        const searchTerm = searchInput.value.trim();
        if (searchTerm) {
            searchDestinations(searchTerm);
        }
    });

    // Event untuk input ketika user menekan Enter
    searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault();
            const searchTerm = this.value.trim();
            if (searchTerm) {
                searchDestinations(searchTerm);
            }
        }
    });
});

// Panggil fungsi saat halaman dimuat
document.addEventListener('DOMContentLoaded', function() {
loadYoTaste();

const sortOptions = document.getElementById('sort-options');
if (sortOptions) {
    sortOptions.addEventListener('change', function() {
        const filter = this.value;
        loadYoTaste(filter);
    });
}
});
    </script>
</html>