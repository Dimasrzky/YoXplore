<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" rel="stylesheet">
</head>
   <style>
        .btn-primary {
            background-color: #91553D;
            border-color: #91553D;
        }
        .btn-primary:hover {
            background-color: #7a4733;
            border-color: #7a4733;
        }
        .bg-primary {
            background-color: #91553D !important;
        }
        .nav-pills .nav-link.active {
            background-color: #91553D;
        }
        .btn-primary:not(:disabled):not(.disabled):active,
        .btn-primary:not(:disabled):not(.disabled).active,
        .btn-primary:focus {
            background-color: #7a4733;
            border-color: #7a4733;
            box-shadow: 0 0 0 0.2rem rgba(145, 85, 61, 0.5);
        }
    </style>
<body>

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-2 bg-dark min-vh-100 p-0">
            <div class="d-flex flex-column flex-shrink-0 p-3 text-white">
                <span class="fs-4 mb-4"><\> YoAdmin</span>
                <ul class="nav nav-pills flex-column mb-auto">
                    <li>
                        <a href="#users" class="nav-link text-white active" data-bs-toggle="pill">
                            <i class="fas fa-users me-2"></i>
                            Users
                        </a>
                    </li>
                    <li>
                        <a href="#yostay" class="nav-link text-white" data-bs-toggle="pill">
                            <i class="fas fa-hotel me-2"></i>
                            YoStay
                        </a>
                    </li>
                    <li>
                        <a href="#yoconcert" class="nav-link text-white" data-bs-toggle="pill">
                            <i class="fas fa-music me-2"></i>
                            YoConcert
                        </a>
                    </li>
                    <li>
                        <a href="#yotaste" class="nav-link text-white" data-bs-toggle="pill">
                            <i class="fas fa-utensils me-2"></i>
                            YoTaste
                        </a>
                    </li>
                    <li>
                        <a href="#yotrip" class="nav-link text-white" data-bs-toggle="pill">
                            <i class="fas fa-plane me-2"></i>
                            YoTrip
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-10 p-4">
            <div class="tab-content">
                <!-- Users Tab -->
                <div class="tab-pane fade show active" id="users">
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="card bg-primary text-white">
                                <div class="card-body">
                                    <h5 class="card-title">Total Users</h5>
                                    <p class="card-text fs-2" id="totalUsers"></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Users Management</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addUserModal">
                            <i class="fas fa-plus me-2"></i>Add User
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <table class="table" id="usersTable">
                                <thead>
                                    <tr>
                                        <th>Username</th>
                                        <th>Email</th>
                                        <th>Created At</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    
                                </tbody>
                            </table>
                        </div>
                    </div>
                <div class="modal fade" id="editUserModal" tabindex="-1">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title">Edit User</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <form id="editUserForm">
                                    <input type="hidden" name="userId" id="editUserId">
                                    <div class="mb-3">
                                        <label class="form-label">Username</label>
                                        <input type="text" class="form-control" name="username" id="editUsername" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" name="email" id="editEmail" required>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">New Password (leave blank to keep current)</label>
                                        <input type="password" class="form-control" name="password" id="editPassword">
                                    </div>
                                </form>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                <button type="button" class="btn btn-primary" onclick="updateUser()">Update User</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="yostay">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>YoStay Management</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#destinationModal">
                            <i class="fas fa-plus me-2"></i>Add Destination
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Destination Name</th>
                                        <th>Address</th>
                                        <th>Open Time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <img src="/api/placeholder/50/50" alt="Hotel" class="img-thumbnail">
                                        </td>
                                        <td>Luxury Hotel</td>
                                        <td>123 Beach Road</td>
                                        <td>24/7</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning me-2">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                            <button class="btn btn-sm btn-danger">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- YoConcert Tab -->
                <div class="tab-pane fade" id="yoconcert">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>YoConcert Management</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#destinationModal">
                            <i class="fas fa-plus me-2"></i>Add Destination
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Destination Name</th>
                                        <th>Address</th>
                                        <th>Open Time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <img src="/api/placeholder/50/50" alt="Concert" class="img-thumbnail">
                                        </td>
                                        <td>City Arena</td>
                                        <td>456 Main Street</td>
                                        <td>10:00 - 22:00</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning me-2">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                            <button class="btn btn-sm btn-danger">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- YoTaste Tab -->
                <div class="tab-pane fade" id="yotaste">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>YoTaste Management</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#destinationModal">
                            <i class="fas fa-plus me-2"></i>Add Destination
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Destination Name</th>
                                        <th>Address</th>
                                        <th>Open Time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <img src="/api/placeholder/50/50" alt="Restaurant" class="img-thumbnail">
                                        </td>
                                        <td>Gourmet Restaurant</td>
                                        <td>789 Food Street</td>
                                        <td>11:00 - 23:00</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning me-2">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                            <button class="btn btn-sm btn-danger">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div class="tab-pane fade" id="yotrip">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>YoTrip Management</h2>
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#destinationModal">
                            <i class="fas fa-plus me-2"></i>Add Destination
                        </button>
                    </div>
                    <div class="card">
                        <div class="card-body">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Destination Name</th>
                                        <th>Address</th>
                                        <th>Open Time</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>
                                            <img src="/api/placeholder/50/50" alt="Restaurant" class="img-thumbnail">
                                        </td>
                                        <td>Gourmet Restaurant</td>
                                        <td>789 Food Street</td>
                                        <td>11:00 - 23:00</td>
                                        <td>
                                            <button class="btn btn-sm btn-warning me-2">
                                                <i class="fas fa-edit"></i> Edit
                                            </button>
                                            <button class="btn btn-sm btn-danger">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- Add User Modal -->
<div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New User</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" name="username" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" name="email" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" name="password" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveUser()">Save User</button>
            </div>
        </div>
    </div>
</div>

<!-- Add Destination Modal -->
<div class="modal fade" id="addDestinationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Destination</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addDestinationForm">
                    <div class="mb-3">
                        <label class="form-label">Destination Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Address</label>
                        <input type="text" class="form-control" name="address" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Open Time</label>
                        <input type="text" class="form-control" name="openTime" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Image</label>
                        <input type="file" class="form-control" name="image" accept="image/*" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveDestination()">Save Destination</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="destinationModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Destination Details</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="destinationForm">
                    <input type="hidden" name="destinationId">
                    <input type="hidden" name="section">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Destination Name</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Address</label>
                                <input type="text" class="form-control" name="address" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Open Time</label>
                                <input type="text" class="form-control" name="openTime" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Image</label>
                                <input type="file" class="form-control" name="image" accept="image/*">
                                <div id="currentImage" class="mt-2"></div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Reviews</label>
                                <div id="reviewsList" class="border rounded p-2" style="max-height: 200px; overflow-y: auto;">
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Add Review</label>
                                <textarea class="form-control" name="newReview" rows="3"></textarea>
                                <div class="mt-2">
                                    <label class="form-label">Rating</label>
                                    <select class="form-select" name="rating">
                                        <option value="5">5 Stars</option>
                                        <option value="4">4 Stars</option>
                                        <option value="3">3 Stars</option>
                                        <option value="2">2 Stars</option>
                                        <option value="1">1 Star</option>
                                    </select>
                                </div>
                                <button type="button" class="btn btn-secondary mt-2" onclick="addReview()">Add Review</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="saveDestination()">Save Changes</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
<script>

function fetchUsers() {
    fetch('../Controller/get_users.php')
        .then(response => response.json())
        .then(result => {
            if (result.success) {
                // Update total users
                document.getElementById('totalUsers').textContent = result.count;
                
                // Update table
                const tbody = document.querySelector('#usersTable tbody');
                tbody.innerHTML = '';
                
                result.data.forEach(user => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>
                            <button class="btn btn-sm btn-warning me-2" onclick="editUser(${user.id})">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            } else {
                console.error('Failed to fetch users:', result.message);
            }
        })
        .catch(error => console.error('Error:', error));
}

// Update total users count
function updateTotalUsers() {
    fetch('../Controller/get_users.php')
        .then(response => response.json())
        .then(data => {
            // Update total users sesuai jumlah data dari database
            document.getElementById('totalUsers').textContent = data.length;
        })
        .catch(error => console.error('Error:', error));
}

// Save user
function saveUser() {
    const form = document.getElementById('addUserForm');
    const formData = new FormData(form);
    
    const user = {
        id: Date.now(),
        username: formData.get('username'),
        email: formData.get('email'),
        password: formData.get('password')
    };
    
    users.push(user);
    localStorage.setItem('users', JSON.stringify(users));
    
    renderUsers();
    updateTotalUsers();
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
    modal.hide();
    form.reset();
}

// Update inisialisasi data
const sections = ['yostay', 'yoconcert', 'yotaste', 'yotrip'];

document.addEventListener('DOMContentLoaded', () => {
    // Initialize users
    renderUsers();
    updateTotalUsers();

    // Initialize destinations for each section
    sections.forEach(section => {
        if (!localStorage.getItem(section)) {
            localStorage.setItem(section, JSON.stringify([]));
        }
        renderDestinations(section);
    });

    // Update add buttons
    sections.forEach(section => {
        const addButton = document.querySelector(`#${section} button.btn-primary`);
        if (addButton) {
            addButton.setAttribute('data-bs-toggle', 'modal');
            addButton.setAttribute('data-bs-target', '#destinationModal');
            addButton.onclick = () => openDestinationModal(section);
        }
    });
});

function saveUser() {
    const form = document.getElementById('addUserForm');
    const formData = new FormData(form);
    
    const user = {
        id: Date.now(),
        username: formData.get('username'),
        email: formData.get('email'),
        password: formData.get('password')
    };
    
    users.push(user);
    localStorage.setItem('users', JSON.stringify(users));
    
    renderUsers();
    updateTotalUsers();
    
    const modal = bootstrap.Modal.getInstance(document.getElementById('addUserModal'));
    modal.hide();
    form.reset();
}

function editUser(id, username, email) {
    document.getElementById('editUserId').value = id;
    document.getElementById('editUsername').value = username;
    document.getElementById('editEmail').value = email;

    new bootstrap.Modal(document.getElementById('editUserModal')).show();
}

function updateUser() {
    const id = document.getElementById('editUserId').value;
    const username = document.getElementById('editUsername').value;
    const email = document.getElementById('editEmail').value;
    const password = document.getElementById('editPassword').value;

    const data = {
        id: id,
        username: username,
        email: email
    };
    
    if(password) {
        data.password = password;
    }

    fetch('../Controller/update_user.php', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if(result.success) {
            bootstrap.Modal.getInstance(document.getElementById('editUserModal')).hide();
            renderUsers(); // Refresh tabel
            alert('User updated successfully');
        } else {
            alert('Failed to update user: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error updating user');
    });
}

function deleteUser(id) {
    if (confirm('Are you sure you want to delete this user?')) {
        fetch('../Controller/delete_user.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: id })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                fetchUsers(); // Refresh user list
            } else {
                alert('Error deleting user');
            }
        })
        .catch(error => console.error('Error:', error));
    }
}

function renderUsers() {
    const tbody = document.querySelector('#usersTable tbody');
    tbody.innerHTML = '';
    
    fetch('../Controller/get_users.php')
        .then(response => response.json())
        .then(data => {
            data.forEach(user => {
                // Format tanggal
                const createdAt = new Date(user.created_at).toLocaleDateString();
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td>${user.username}</td>
                    <td>${user.email}</td>
                    <td>${createdAt}</td>
                    <td>
                        <button class="btn btn-warning btn-sm" onclick="editUser(${user.id}, '${user.username}', '${user.email}')">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-danger btn-sm ms-2" onclick="deleteUser(${user.id})">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        })
}

// Destination functions
function openDestinationModal(section, id = null) {
    const destinations = JSON.parse(localStorage.getItem(section)) || [];
    const form = document.getElementById('destinationForm');
    form.reset();
    
    form.querySelector('[name="section"]').value = section;
    
    if (id) {
        const destination = destinations.find(d => d.id === id);
        if (!destination) return;

        form.querySelector('[name="destinationId"]').value = destination.id;
        form.querySelector('[name="name"]').value = destination.name;
        form.querySelector('[name="address"]').value = destination.address;
        form.querySelector('[name="openTime"]').value = destination.openTime;
        
        // Show current image
        const currentImage = document.getElementById('currentImage');
        currentImage.innerHTML = `
            <img src="${destination.image}" alt="Current image" class="img-thumbnail" style="height: 100px">
        `;
        
        // Render reviews
        renderReviews(destination.reviews || []);
    } else {
        form.querySelector('[name="destinationId"]').value = '';
        document.getElementById('currentImage').innerHTML = '';
        renderReviews([]);
    }

    new bootstrap.Modal(document.getElementById('destinationModal')).show();
}

function renderReviews(reviews) {
    const reviewsList = document.getElementById('reviewsList');
    reviewsList.innerHTML = reviews.map(review => `
        <div class="review-item border-bottom p-2">
            <div class="d-flex justify-content-between">
                <strong>${'★'.repeat(review.rating)}${'☆'.repeat(5-review.rating)}</strong>
                <small>${new Date(review.date).toLocaleDateString()}</small>
            </div>
            <p class="mb-0">${review.text}</p>
        </div>
    `).join('') || '<p class="text-muted">No reviews yet</p>';
}

function addReview() {
    const form = document.getElementById('destinationForm');
    const text = form.querySelector('[name="newReview"]').value;
    const rating = parseInt(form.querySelector('[name="rating"]').value);
    
    if (!text) return;

    const section = form.querySelector('[name="section"]').value;
    const id = parseInt(form.querySelector('[name="destinationId"]').value);
    
    const destinations = JSON.parse(localStorage.getItem(section)) || [];
    const destinationIndex = destinations.findIndex(d => d.id === id);
    
    if (destinationIndex === -1) return;

    const review = {
        id: Date.now(),
        text,
        rating,
        date: new Date().toISOString()
    };

    destinations[destinationIndex].reviews = destinations[destinationIndex].reviews || [];
    destinations[destinationIndex].reviews.push(review);
    
    localStorage.setItem(section, JSON.stringify(destinations));
    
    form.querySelector('[name="newReview"]').value = '';
    renderReviews(destinations[destinationIndex].reviews);
}

function saveDestination() {
    const form = document.getElementById('destinationForm');
    const formData = new FormData(form);
    
    // Convert section name untuk match dengan ENUM di database
    const section = formData.get('section');
    formData.set('feature_type', section.charAt(0).toUpperCase() + section.slice(1));
    
    fetch('../Controller/save_destination.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(result => {
        if(result.success) {
            loadDestinations(section);
            const modal = bootstrap.Modal.getInstance(document.getElementById('destinationModal'));
            modal.hide();
            form.reset();
            alert('Destination saved successfully');
        } else {
            alert('Failed to save destination: ' + result.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Error saving destination');
    });
}

function editDestination(id, section) {
    fetch(`../Controller/get_destination.php?id=${id}`)
        .then(response => response.json())
        .then(result => {
            if(result.success) {
                const data = result.data;
                const form = document.getElementById('destinationForm');
                
                form.querySelector('[name="destinationId"]').value = data.id;
                form.querySelector('[name="name"]').value = data.name;
                form.querySelector('[name="address"]').value = data.address;
                form.querySelector('[name="openTime"]').value = data.opening_hours;
                form.querySelector('[name="section"]').value = section;
                
                // Show current image if exists
                if(data.id) {
                    document.getElementById('currentImage').innerHTML = `
                        <img src="../Controller/get_image.php?id=${data.id}" 
                             alt="Current image" 
                             class="img-thumbnail" 
                             style="height: 100px; object-fit: cover;">
                    `;
                }
                
                new bootstrap.Modal(document.getElementById('destinationModal')).show();
            } else {
                alert('Failed to load destination data');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error loading destination data');
        });
}

function deleteDestination(id, section) {
    if(confirm('Are you sure you want to delete this destination?')) {
        fetch('../Controller/delete_destination.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: id })
        })
        .then(response => response.json())
        .then(result => {
            if(result.success) {
                loadDestinations(section);
                alert('Destination deleted successfully');
            } else {
                alert('Failed to delete destination: ' + result.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error deleting destination');
        });
    }
}

function renderDestinations(section) {
    const destinations = JSON.parse(localStorage.getItem(section)) || [];
    const tbody = document.querySelector(`#${section} table tbody`);
    tbody.innerHTML = '';
    
    destinations.forEach(dest => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
            <td><img src="${dest.image}" alt="${dest.name}" class="img-thumbnail" style="width: 50px; height: 50px"></td>
            <td>${dest.name}</td>
            <td>${dest.address}</td>
            <td>${dest.openTime}</td>
            <td>
                <button class="btn btn-sm btn-warning me-2" onclick="openDestinationModal('${section}', ${dest.id})">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-sm btn-danger" onclick="deleteDestination('${section}', ${dest.id})">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

function loadDestinations(section) {
    // Convert ke format yang sesuai dengan ENUM di database
    let feature_type = section.charAt(0).toUpperCase() + section.slice(1);
    
    fetch('../Controller/get_destinations.php?section=' + feature_type)
        .then(response => response.json())
        .then(result => {
            if(result.success) {
                const tbody = document.querySelector(`#${section} table tbody`);
                tbody.innerHTML = '';
                
                if(result.data.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="5" class="text-center">No data available</td>
                        </tr>
                    `;
                    return;
                }

                result.data.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>
                            <img src="../Controller/get_image.php?id=${item.id}" 
                                 alt="${item.name}" 
                                 class="img-thumbnail" 
                                 style="width: 50px; height: 50px; object-fit: cover;">
                        </td>
                        <td>${item.name}</td>
                        <td>${item.address}</td>
                        <td>${item.opening_hours || '-'}</td>
                        <td>
                            <div class="d-flex gap-2">
                                <button class="btn btn-sm btn-warning" 
                                        onclick="editDestination(${item.id}, '${section}')">
                                    <i class="fas fa-edit"></i> Edit
                                </button>
                                <button class="btn btn-sm btn-danger" 
                                        onclick="deleteDestination(${item.id}, '${section}')">
                                    <i class="fas fa-trash"></i> Delete
                                </button>
                            </div>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            const tbody = document.querySelector(`#${section} table tbody`);
            tbody.innerHTML = `
                <tr>
                    <td colspan="5" class="text-center text-danger">Error loading data</td>
                </tr>
            `;
        });
}

document.addEventListener('DOMContentLoaded', () => {
    // Initialize tabs
    const triggerTabList = document.querySelectorAll('[data-bs-toggle="pill"]');
    triggerTabList.forEach(triggerEl => {
        triggerEl.addEventListener('shown.bs.tab', event => {
            const targetId = event.target.getAttribute('href').slice(1);
            if(targetId !== 'users') {
                loadDestinations(targetId);
            }
        });
    });

    // Load initial content
    renderUsers();
    updateTotalUsers();
    
    // Load initial destinations if not on users tab
    const activeTab = document.querySelector('.nav-link.active');
    const initialSection = activeTab.getAttribute('href').slice(1);
    if(initialSection !== 'users') {
        loadDestinations(initialSection);
    }
    
    // Auto refresh users data
    setInterval(() => {
        if(document.querySelector('#users').classList.contains('active')) {
            renderUsers();
            updateTotalUsers();
        }
    }, 3000);
});
</script>
</body>
</html>